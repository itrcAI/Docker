### داکر چیست؟

**Docker** یک پلتفرم متن‌باز برای توسعه، انتقال، و اجرای برنامه‌ها در محیطی جداگانه به نام **کانتینر** است. Docker به توسعه‌دهندگان و مهندسان DevOps این امکان را می‌دهد که برنامه‌های خود را در یک محیط ایزوله (کانتینر) اجرا کنند که تمامی نیازهای نرم‌افزاری آن برنامه را به همراه دارد. این قابلیت باعث می‌شود که اپلیکیشن‌ها بدون مشکل در هر محیطی، از کامپیوتر شخصی توسعه‌دهنده تا سرورهای تولید، قابل اجرا باشند.

### کانتینر چیست؟

**کانتینر** (Container) یک واحد سبک‌وزن و مستقل از نرم‌افزار است که شامل تمامی اجزا و وابستگی‌های مورد نیاز برای اجرای یک اپلیکیشن می‌باشد، مانند کدهای برنامه، کتابخانه‌ها، فایل‌های پیکربندی، و سایر وابستگی‌ها. برخلاف ماشین‌های مجازی (Virtual Machines)، کانتینرها سیستم‌عامل مستقلی را شامل نمی‌شوند و از کرنل سیستم‌عامل میزبان استفاده می‌کنند. این امر باعث می‌شود کانتینرها سریع‌تر و کم‌حجم‌تر از ماشین‌های مجازی باشند.

### تفاوت کانتینر و ماشین مجازی (VM)

کانتینرها و ماشین‌های مجازی هر دو ابزارهایی برای ایزوله‌سازی برنامه‌ها در محیط‌های مجزا هستند، اما تفاوت‌های مهمی دارند:

- **ماشین مجازی (VM):**
  - هر VM دارای یک سیستم‌عامل کامل به همراه اپلیکیشن‌ها و وابستگی‌های آن است.
  - سنگین‌تر است و منابع بیشتری (رم و پردازنده) نیاز دارد.
  - راه‌اندازی VM زمان بیشتری می‌برد.
  
- **کانتینر:**
  - کانتینرها فقط اجزای مورد نیاز برنامه را به همراه دارند و از کرنل سیستم‌عامل میزبان استفاده می‌کنند.
  - سبک‌تر هستند و منابع کمتری نیاز دارند.
  - به سرعت راه‌اندازی می‌شوند.

### چرا از داکر و کانتینر استفاده کنیم؟

1. **قابلیت حمل (Portability):**
   برنامه‌ای که داخل یک کانتینر اجرا می‌شود، همراه با تمام وابستگی‌هایش است. بنابراین می‌توانید آن را در هر محیطی، بدون نگرانی از تفاوت‌های محیطی (مانند سیستم‌عامل‌ها یا نسخه‌های مختلف نرم‌افزارها) اجرا کنید.

2. **کارایی بالا (Efficiency):**
   کانتینرها نسبت به ماشین‌های مجازی سبک‌تر و سریع‌تر هستند زیرا نیازی به اجرای یک سیستم‌عامل کامل در هر کانتینر نیست. این باعث کاهش استفاده از منابع سخت‌افزاری می‌شود.

3. **مقیاس‌پذیری (Scalability):**
   با Docker می‌توان به راحتی چندین کانتینر از یک اپلیکیشن را روی سرورهای مختلف اجرا کرد. این قابلیت مقیاس‌پذیری، به ویژه در زیرساخت‌های ابری، بسیار مفید است.

4. **جداسازی (Isolation):**
   کانتینرها از یکدیگر و از سیستم‌عامل میزبان ایزوله هستند. این ایزوله‌سازی به این معناست که مشکلات یک کانتینر تأثیری بر سایر کانتینرها یا سیستم‌عامل میزبان نخواهد داشت.

### اجزای اصلی Docker

- **Docker Engine**: هسته اصلی Docker است که به عنوان یک سرویس روی سیستم شما نصب می‌شود و کانتینرها را مدیریت می‌کند.
- **Docker Image**: یک فایل یا الگوی غیرقابل تغییر است که شامل سیستم فایل و تنظیمات مورد نیاز برای اجرای یک اپلیکیشن درون یک کانتینر است. Imageها پایه‌ای هستند که کانتینرها از روی آنها ساخته می‌شوند.
- **Docker Container**: نمونه‌ای از یک Docker Image است که در حال اجراست. کانتینرها به‌صورت ایزوله و با استفاده از منابع مشترک سیستم‌عامل میزبان اجرا می‌شوند.
- **Docker Hub**: یک مخزن عمومی و ابری است که به شما اجازه می‌دهد Docker Imageهای خود را به اشتراک بگذارید و یا Imageهای آماده را دانلود کنید.

### نحوه کار Docker

وقتی یک **Docker Image** ساخته می‌شود، شامل تمامی وابستگی‌های مورد نیاز برای اجرای برنامه است (از جمله کتابخانه‌ها، فایل‌های پیکربندی، و غیره). سپس شما می‌توانید این Image را به یک **کانتینر** تبدیل کنید و آن را در هر محیطی که Docker نصب شده است اجرا کنید.

به عنوان مثال، فرض کنید یک اپلیکیشن وب با Flask نوشته‌اید. اگر بخواهید این اپلیکیشن را روی سیستم‌های مختلف اجرا کنید، نیاز است که نسخه‌های مختلف Python و سایر کتابخانه‌های وابسته نصب شود. اما با Docker، شما همه این موارد را داخل یک Image بسته‌بندی می‌کنید و سپس با اجرای یک کانتینر از آن Image، بدون نیاز به نصب نرم‌افزارها، اپلیکیشن شما قابل اجرا خواهد بود.

---

با استفاده از Docker و کانتینرها، فرآیند توسعه، تست، و انتقال نرم‌افزار به محیط‌های مختلف ساده‌تر و سریع‌تر می‌شود.





---

# آموزش Dockerfile

## Dockerfile چیست؟

Dockerfile یک اسکریپت است که شامل مجموعه‌ای از دستورات برای ساخت یک Docker image می‌باشد. داکر از این فایل برای خودکارسازی نصب و پیکربندی نرم‌افزار داخل یک کانتینر استفاده می‌کند.

## ساختار پایه Dockerfile

یک Dockerfile معمولی شامل ساختار زیر است:

```dockerfile
# 1. تصویر پایه (Base Image)
FROM <base-image>

# 2. نگهدارنده
LABEL maintainer="your_name@example.com"

# 3. تنظیم دایرکتوری کاری
WORKDIR /app

# 4. کپی کردن فایل‌ها
COPY <source> <destination>

# 5. نصب وابستگی‌ها
RUN <command>

# 6. معرفی پورت‌ها
EXPOSE <port>

# 7. دستور پیش‌فرض
CMD ["command", "argument"]
```

بیایید هر مرحله را توضیح دهیم:

### 1. `FROM`
دستور `FROM` تصویر پایه‌ای را که کانتینر بر اساس آن ساخته می‌شود مشخص می‌کند. این تصویر می‌تواند از Docker Hub یا یک تصویر سفارشی باشد. نمونه‌ای رایج:

```dockerfile
FROM python:3.8-slim
```
این دستور، تصویر Python نسخه 3.8-slim را به عنوان تصویر پایه انتخاب می‌کند.

### 2. `LABEL`
دستور `LABEL` برای افزودن متادیتا به تصویر استفاده می‌شود. به عنوان مثال، نگهدارنده تصویر را مشخص می‌کند:

```dockerfile
LABEL maintainer="your_email@example.com"
```

### 3. `WORKDIR`
دستور `WORKDIR` دایرکتوری کاری داخل کانتینر را تنظیم می‌کند. دستورات بعدی نسبت به این دایرکتوری اجرا می‌شوند:

```dockerfile
WORKDIR /app
```

### 4. `COPY`
دستور `COPY` فایل‌ها را از سیستم میزبان به کانتینر کپی می‌کند. ساختار آن به صورت زیر است:

```dockerfile
COPY <source> <destination>
```

به عنوان مثال، برای کپی کردن کد اپلیکیشن به داخل کانتینر:

```dockerfile
COPY . /app
```

### 5. `RUN`
دستور `RUN` برای اجرای دستورات داخل کانتینر در هنگام ساخت تصویر استفاده می‌شود، مانند نصب وابستگی‌ها:

```dockerfile
RUN pip install -r requirements.txt
```

### 6. `EXPOSE`
دستور `EXPOSE` مشخص می‌کند که کانتینر روی کدام پورت گوش می‌دهد. این دستور به‌طور خودکار پورت را به میزبان منتشر نمی‌کند، بلکه فقط به داکر اطلاع می‌دهد که اپلیکیشن از این پورت استفاده می‌کند:

```dockerfile
EXPOSE 5000
```

### 7. `CMD`
دستور `CMD` فرمان پیش‌فرضی را مشخص می‌کند که هنگام اجرای کانتینر اجرا می‌شود. به عنوان مثال:

```dockerfile
CMD ["python", "app.py"]
```

این دستور، هنگام اجرای کانتینر، برنامه `app.py` را با Python اجرا می‌کند. فقط یک دستور `CMD` در Dockerfile می‌تواند استفاده شود.

## مثال کامل Dockerfile

در اینجا یک Dockerfile کامل برای یک اپلیکیشن وب Flask با Python آورده شده است:

```dockerfile
# 1. تصویر پایه
FROM python:3.8-slim

# 2. نگهدارنده
LABEL maintainer="your_email@example.com"

# 3. تنظیم دایرکتوری کاری داخل کانتینر
WORKDIR /app

# 4. کپی کردن محتویات دایرکتوری کنونی به داخل کانتینر در مسیر /app
COPY . /app

# 5. نصب پکیج‌های مورد نیاز که در فایل requirements.txt مشخص شده است
RUN pip install --no-cache-dir -r requirements.txt

# 6. در دسترس قرار دادن پورت 5000 برای جهان خارج از این کانتینر
EXPOSE 5000

# 7. تنظیم یک متغیر محیطی
ENV NAME World

# 8. اجرای app.py وقتی که کانتینر راه‌اندازی می‌شود
CMD ["python", "app.py"]
```

## ساخت و اجرای کانتینر داکر

برای ساخت یک تصویر داکر از Dockerfile، از دستور زیر در ترمینال (داخل فولدری که Dockerfile در آن قرار دارد) استفاده کنید:

```bash
docker build -t my-python-app .
```

برای اجرای کانتینر داکر:

```bash
docker run -p 5000:5000 my-python-app
```

این دستور، پورت 5000 کانتینر را به پورت 5000 ماشین محلی شما متصل می‌کند و شما می‌توانید اپلیکیشن را در مرورگر خود در آدرس `http://localhost:5000` مشاهده کنید.

## نکات بهترین عملکرد

- از تصاویر پایه کوچک مانند `alpine` یا `slim` برای کاهش حجم تصویر استفاده کنید.
- از ساخت‌های چند مرحله‌ای استفاده کنید تا تصویر نهایی تمیز و کوچک باشد.
- از کش ساخت داکر با ترتیب‌دهی مناسب دستورات استفاده کنید (به عنوان مثال، دستورهای `COPY` و `RUN` که به ندرت تغییر می‌کنند را در بالای فایل قرار دهید).
- همیشه یک دستور `CMD` تعریف کنید تا کانتینر بداند به‌صورت پیش‌فرض چه چیزی را اجرا کند.

---





